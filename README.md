## RubyとSeleniumを使った、ブラウザ操作を伴うスクレイピングプログラムです!

毎日、決まった時間になると、いつものwebサイトに行って、いつもの操作をして、いつものデータを確認・記録してるなんてことはありませんか？  
そして、急いでるときにブラウザの反応が遅いといらいらしますよね…

・・・私は企業相手に品物を受注生産・販売を行っている会社に勤めていますが、取引先の発注方法は様々です。昔はFAXや郵送、電子メールで注文書が届いていましたが、最近ではWeb-EDIで注文書が発行される取引先も多くなってきました。
Web-EDIの注文書は、FAX/郵送/電子メールなどとは違い、自分から取引先指定のWebサイトへ訪問・ログインし、情報を取得しなければなりません。つまり、毎日数回、忘れずに確認しないと、取引先からの情報の受け取り漏れが発生してしまいます。
※ 注文書以外にも、輸出に関する情報や含有成分調査などの大事な情報も Web-EDI でやり取りされます。

というわけで、とても大事な情報の受け取りだけど、毎日毎回めんどくせぇ。やりたくない！
と、いう経緯で作ったプログラムです。

## 具体的になにができるの？

プログラムが起動すると、事前に作成した訪問先URLリスト（csvファイル）と、訪問先Webサイトでの操作内容を記したプログラム(Rubyというプログラミング言語)に従って、動作します。
具体的には、事前に設定しておいた複数のWebサイトを訪問し、ログインが必要ならログインして目的のページの最新情報を取得して記録、関係者へメール配信し作業ログも残します。

以下、サンプルプログラムでの実行結果です。

1件目でログインしているTaskleafというWebサイトは、私が Ruby on Rails の学習過程で制作し、HerokuへデプロイしたWebアプリですが、内容を見るためにはログイン操作が必要です。つまり、この情報が取得できているということは、「TaskleafというWebサイトへ訪問し、ログイン操作が成功している」ということです。
2件目のYahoo!japan トップページへのアクセスでは、ログイン操作は行っておらず、接続したタイミングでの最新ニュース見出しを取得しています。

```
--------------------
訪問リスト読み込み中
--------------------
1件目 Taskleaf からデータ取得中… 完了
2020-11-23 23:00:07,Taskleaf,1面を揃える 2020-11-23 07:45:54 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,中段の色を揃える 2020-11-23 07:48:19 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,上面クロスを作る 2020-11-23 07:50:29 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,上面を揃える 2020-11-23 07:51:06 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,6面完成 2020-11-23 07:53:24 +0900 編集削除
--------------------
2件目 yahoo!japan からデータ取得中… 完了
2020-11-23 23:00:11,yahoo!japan,重症331人「第1波」超え最多,3062
2020-11-23 23:00:11,yahoo!japan,武漢に在外公館の開設を検討,390
2020-11-23 23:00:11,yahoo!japan,河野氏 首相になって政策実現,3134
2020-11-23 23:00:11,yahoo!japan,車と衝突 阪急1両目が脱線,NEW
2020-11-23 23:00:11,yahoo!japan,荒む人心 電話相談員の胸中,NEW,166
2020-11-23 23:00:11,yahoo!japan,競馬史に残る 夢の3強対決,1117
2020-11-23 23:00:11,yahoo!japan,横審 白鵬と鶴竜に注意を決議,2109
2020-11-23 23:00:11,yahoo!japan,神尾楓珠 林田真尋と交際報道,2555
--------------------
ログファイル書き込み中… 成功
MacBook-Pro-A:scraping_with_selenium atsushi$ 
MacBook-Pro-A:scraping_with_selenium atsushi$ 
MacBook-Pro-A:scraping_with_selenium atsushi$ cat logfile.txt 
2020-11-23 23:00:07,Taskleaf,1面を揃える 2020-11-23 07:45:54 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,中段の色を揃える 2020-11-23 07:48:19 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,上面クロスを作る 2020-11-23 07:50:29 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,上面を揃える 2020-11-23 07:51:06 +0900 編集削除
2020-11-23 23:00:07,Taskleaf,6面完成 2020-11-23 07:53:24 +0900 編集削除
2020-11-23 23:00:11,yahoo!japan,重症331人「第1波」超え最多,3062
2020-11-23 23:00:11,yahoo!japan,武漢に在外公館の開設を検討,390
2020-11-23 23:00:11,yahoo!japan,河野氏 首相になって政策実現,3134
2020-11-23 23:00:11,yahoo!japan,車と衝突 阪急1両目が脱線,NEW
2020-11-23 23:00:11,yahoo!japan,荒む人心 電話相談員の胸中,NEW,166
2020-11-23 23:00:11,yahoo!japan,競馬史に残る 夢の3強対決,1117
2020-11-23 23:00:11,yahoo!japan,横審 白鵬と鶴竜に注意を決議,2109
2020-11-23 23:00:11,yahoo!japan,神尾楓珠 林田真尋と交際報道,2555
```

## 必要なものは？

 このプログラムを動かすために必要なものを下記に示します。
 (Rubyバージョンについては必ず合っていなくても、ある程度近ければ大丈夫だと思います。)

 * ruby 2.6.6
 * selenium-webdriver (3.142.7)
 * Google Chrome
 * chromedriver (Google Chromeのバージョンと合致したものが必要)

## 使い方

- 事前に`visiting_.csv`というファイルへ訪問先の情報を登録します。（初期状態ではサンプルで id: 2件目まで入っていますが、1行目（タイトル）だけ残して削除して頂いて構いません。）
  - id: 基本的に通し番号です。重複禁止です。
  - name: お好きなお名前で大丈夫です。「○○社 発注情報」 など
  - url: 最初にアクセスする場所（トップページ）です。
  - userid: 対象URLへ訪問する際の固有のお名前です。Webサイトによっては「ID」とか「メルアド」などの場合があります。
  - password: 入力ミスに気を付けて設定して下さい。Webサイトによっては、「あと何回間違ったらアカウントロック」等のメッセージがない場合もありますのでご注意を。

- Websiteクラスを継承したサブクラスを作成し、固有の処理を書き込みます。
  - Webサイトによって記述内容が変わりますので、お使いになる場合は selenium の参考書などをご参照ください。

一通りの設定が済んだら、下記を実行しましょう。

`ruby main.rb`


## 注意点

Webスクレイピングは権利を保証されいてる一方、悪用すると大変なことにもなります。ご使用の前に下記の記事をお読みいただくことをお勧めいたします。

[- Webスクレイピングの注意事項一覧](https://qiita.com/nezuq/items/c5e827e1827e7cb29011)

[- WEBスクレイピングの技術と懸念事項](https://qiita.com/tetsukick/items/6b4322199d4702047ced)
